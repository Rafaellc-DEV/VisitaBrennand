<!DOCTYPE html>
<html lang="pt" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Relatórios - Painel administrativo</title>

    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>

    <!-- admin shared styles -->
    <link rel="stylesheet" th:href="@{/css/admin.css}" href="/css/admin.css">

    <!-- report scoped css (won't overwrite admin styles) -->
    <link rel="stylesheet" th:href="@{/relatorio-feedbacks/styles.css}" href="/relatorio-feedbacks/styles.css">
    <style>
        /* small visual adjustments to integrate with admin layout */
        .report-shell { width:100%; }
        .report-header { text-align:center; margin-bottom:18px; }
        .report-header h1{ font-size:1.6rem; color:#294A5D; }
    </style>
</head>
<body>
<div class="app">

    <!-- reuse the same sidebar as admin (markup similar to admin/index.html) -->
    <aside class="sidebar d-flex flex-column">
        <div class="brand">
            <h1>VISITA<br/>BRENNAND</h1>
        </div>
        <div class="px-3 pt-3">
            <div class="menu-section">Principal</div>
            <nav class="nav flex-column">
                <div class="nav-item"><a class="nav-link" th:href="@{/admin/avisos}" th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI != null and #httpServletRequest.requestURI.startsWith('/admin/avisos')} ? ' active' : ''"><i class="bi bi-bell"></i> Avisos</a></div>
                <div class="nav-item"><a class="nav-link" th:href="@{/admin/horarios}" th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI != null and #httpServletRequest.requestURI.startsWith('/admin/horarios')} ? ' active' : ''"><i class="bi bi-clock"></i> Horários</a></div>
                <div class="nav-item"><a class="nav-link" th:href="@{/admin/regras}" th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI != null and #httpServletRequest.requestURI.startsWith('/admin/regras')} ? ' active' : ''"><i class="bi bi-journal-check"></i> Regras</a></div>
            </nav>
            <div class="menu-section">Gestão</div>
            <nav class="nav flex-column mb-4">
                <div class="nav-item"><a class="nav-link" th:href="@{/admin/feedbacks}" th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI != null and #httpServletRequest.requestURI.startsWith('/admin/feedbacks')} ? ' active' : ''"><i class="bi bi-chat-square-heart"></i> Feedbacks</a></div>
                <div class="nav-item"><a class="nav-link" th:href="@{/admin/relatorios}" th:classappend="${#httpServletRequest != null and #httpServletRequest.requestURI != null and #httpServletRequest.requestURI.startsWith('/admin/relatorios')} ? ' active' : ''"><i class="bi bi-graph-up"></i> Relatórios</a></div>
            </nav>
        </div>
        <div class="sidebar-footer">
            <div class="user-card mb-2">
                <div class="avatar">A</div>
                <div class="small">
                    <div class="fw-semibold">Administrador</div>
                    <div class="text-muted">@admin</div>
                </div>
            </div>
            <a class="btn btn-outline-secondary w-100" th:href="@{/logout}"><i class="bi bi-box-arrow-left me-1"></i> Sair</a>
        </div>
    </aside>

    <main class="d-flex flex-column">
        <div class="topbar">
            <button class="btn d-lg-none" type="button" data-bs-toggle="offcanvas" data-bs-target="#mobileMenu"><i class="bi bi-list fs-3"></i></button>
            <h2 class="title d-none d-lg-block">Painel administrativo</h2>
            <a class="btn btn-sm btn-outline-secondary" th:href="@{/}"><i class="bi bi-house me-1"></i> Ver site</a>
        </div>

        <section class="content">
            <div class="report-shell container-fluid">
                <div class="report-header">
                    <h1>Relatório de Feedbacks</h1>
                </div>

                <!-- Filters / controls similar to original design -->
                <div class="filters-card mb-4">
                    <div class="filters-inner container">
                        <div class="filters-title">
                            <h5 class="mb-0">Feedbacks Recebidos</h5>
                        </div>
                        <div class="filters-controls d-flex gap-3 mt-3 flex-wrap">
                            <div class="form-floating">
                                <select class="form-select" id="filterType">
                                    <option value="all">Todos</option>
                                    <option value="positive">Positivos</option>
                                    <option value="negative">Negativos</option>
                                </select>
                                <label for="filterType">Filtrar por tipo</label>
                            </div>
                            <div class="form-floating">
                                <select class="form-select" id="orderBy">
                                    <option value="recent">Mais recentes</option>
                                    <option value="rating">Melhores avaliados</option>
                                </select>
                                <label for="orderBy">Ordenar por</label>
                            </div>
                            <div class="ms-auto align-self-end">
                                <button class="btn btn-primary btn-apply">Aplicar filtros</button>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="report-stats-grid">
                    <div class="report-stat-card">
                        <h3>Média Geral</h3>
                        <div class="report-stat-value">4.7</div>
                        <div class="report-stat-sub">★★★★★</div>
                    </div>
                    <div class="report-stat-card">
                        <h3>Total de Feedbacks</h3>
                        <div class="report-stat-value">127</div>
                        <div class="report-stat-label">últimos 30 dias</div>
                    </div>
                    <div class="report-stat-card">
                        <h3>Satisfação</h3>
                        <div class="report-stat-value">93%</div>
                        <div class="report-stat-label">avaliações positivas</div>
                    </div>
                </div>

                <div class="report-charts-grid">
                    <div class="report-chart-card">
                        <h3>Avaliações por Estrelas</h3>
                        <canvas id="starsChart"></canvas>
                    </div>
                    <div class="report-chart-card">
                        <h3>Evolução das Avaliações</h3>
                        <canvas id="timelineChart"></canvas>
                    </div>
                </div>

                <div class="report-chart-card report-full">
                    <h3>Principais Temas Mencionados</h3>
                    <canvas id="themesChart"></canvas>
                </div>
            </div>
        </section>
    </main>
</div>

<div class="offcanvas offcanvas-start" tabindex="-1" id="mobileMenu">
    <div class="offcanvas-header border-bottom">
        <h5 class="offcanvas-title">Menu</h5>
        <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Charts (same data as before but using scoped class markup)
    new Chart(document.getElementById('starsChart'), {
        type: 'bar',
        data: {
            labels: ['1★','2★','3★','4★','5★'],
            datasets: [{ label: 'Quantidade de Avaliações', data:[2,5,15,45,60], backgroundColor:'#294A5D' }]
        },
        options: { responsive:true, scales:{ y:{ beginAtZero:true } } }
    });

    new Chart(document.getElementById('timelineChart'), {
        type:'line', data:{ labels:['Jun','Jul','Ago','Set','Out','Nov'], datasets:[{ label:'Média Mensal', data:[4.2,4.3,4.5,4.7,4.7,4.8], borderColor:'#294A5D', tension:0.1 }]}, options:{ responsive:true, scales:{ y:{ min:0, max:5 } } }
    });

    new Chart(document.getElementById('themesChart'), {
        type:'bar', data:{ labels:['Atendimento','Limpeza','Localização','Preço','Exposição','Acessibilidade'], datasets:[{ label:'Menções', data:[85,72,68,45,90,55], backgroundColor:'#294A5D' }] }, options:{ indexAxis:'y', responsive:true }
    });
</script>
</body>
</html>
